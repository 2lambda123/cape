#!/usr/bin/env python

# System
import os, sys
# Import the full module
import cape
# Automated report generation
import cape.report
# Input parsing
from cape.argread import readflagstar

# Import docstring (makes the docstring available to module import)
import pc_doc
__doc__ = pc_doc.__doc__
    
# Check if run as a script.
if __name__ == "__main__":
    # Parse inputs.
    a, kw = readflagstar(sys.argv)
    
    # Check for a help flag.
    if kw.get('h') or kw.get('help'):
        # Import string processing
        import cape.text
        # Print marked-down docstring
        print(cape.text.markdown(__doc__))
        # Exit
        sys.exit()
    
    # Get constraints and convert text to list.
    cons  = kw.get('cons',        '').split(',')
    cons += kw.get('constraints', '').split(',')
    # Set the constraints back into the keywords.
    kw['cons'] = [con.strip() for con in cons]
        
    # Get file name.
    fname = kw.get('f', 'cape.json')
    
    # Try to read it.
    cntl = cape.Cntl(fname)
    
    # Call the command-line interface
    cntl.cli(*a, **kw)
    
